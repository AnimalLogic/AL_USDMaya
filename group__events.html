<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>AL_USDMaya: Core Event System</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">AL_USDMaya
   &#160;<span id="projectnumber">0.29.4</span>
   </div>
   <div id="projectbrief">USD to Maya Bridge</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__events.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Core Event System<div class="ingroups"><a class="el" href="group__mayautils.html">Maya Helpers</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>The AL_USDMaya event system attempts to provide a more robust event system for Maya that works around some of the short comings of the MMessage/scriptJob approach. This system is employed within AL_USDMaya to expose programming hooks that can be used to execute your own code during the internal processes of AL_USDMaya <em>(e.g. before/after a variant switch)</em>  
<a href="#details">More...</a></p>
<p>The AL_USDMaya event system attempts to provide a more robust event system for Maya that works around some of the short comings of the MMessage/scriptJob approach. This system is employed within AL_USDMaya to expose programming hooks that can be used to execute your own code during the internal processes of AL_USDMaya <em>(e.g. before/after a variant switch)</em> </p>
<h1><a class="anchor" id="events_Motivation"></a>
Events Motivation</h1>
<h2><a class="anchor" id="MMessage"></a>
Why not use scriptJob / MMessage?</h2>
<p>Maya already has its own event management system, which are exposed via the MMessage <em>(and derived classes)</em> in the API, and scriptJob within MEL/python. These systems work, but they have a number of drawbacks when deployed in a medium to large sized studio with multiple shows in flight. As an example of some of the problems that can arise, consider this scenario:</p>
<div class="fragment"><div class="line"><span class="comment">// A callback that will create a node we will store some shot settings on</span></div>
<div class="line">global proc onFileNew_createMagicNode()</div>
<div class="line">{</div>
<div class="line">  $node = `createNode <span class="stringliteral">&quot;transform&quot;</span>`;</div>
<div class="line">  rename $node <span class="stringliteral">&quot;essential_shot_settings&quot;</span>;</div>
<div class="line">}</div>
<div class="line">global <span class="keywordtype">int</span> $scriptJob1 = `scriptJob -e <span class="stringliteral">&quot;NewSceneOpened&quot;</span> <span class="stringliteral">&quot;onFileNew_createMagicNode&quot;</span>`;</div>
<div class="line"></div>
<div class="line"><span class="comment">// A callback that will group all nodes into a set we can ignore at export time</span></div>
<div class="line">global proc onFileNew_createDefaultSetOfNodes()</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// add all transforms into a set to ignore at export</span></div>
<div class="line">  sets -n <span class="stringliteral">&quot;doNotExport&quot;</span> `ls -type transform`;</div>
<div class="line">}</div>
<div class="line">global <span class="keywordtype">int</span> $scriptJob2 = `scriptJob -e <span class="stringliteral">&quot;NewSceneOpened&quot;</span> <span class="stringliteral">&quot;onFileNew_createDefaultSetOfNodes&quot;</span>`;</div>
</div><!-- fragment --><p>Now in this case, since we are registering those script jobs in a specific order, when a 'file new' occurs, our custom shot node will be created, and it will be added to the set of nodes to ignore at export time. All well and good!</p>
<p>If however we registered scriptJob2 first, we'd end up with the set being created first, and then we'd create our shot settings node <em>(which would not be part of the set)</em>. Now who knows which is the right way around in this context <em>(it is after all an illustrative example!)</em>, but the important take home message here, is that there can be behavioural changes when scriptJobs and MMessages are registered in differing orders.</p>
<p>This is often a problem in most studios, since it's likely that those two scriptJobs <em>(or MMessage events)</em> are actually located in different plug-ins, and therefore small bugs can be introduced if the events are accidentally registered in an incorrect order.</p>
<p>In cases where small bugs are introduced, it is often extremely hard to track down what has caused the offending bug, since the maya event system doesn't really give you an adequate way to track down which events triggered which callbacks, and more importantly any ideas in how to track down the code that contained the events.</p>
<h2><a class="anchor" id="terminology"></a>
Some Terminology</h2>
<ul>
<li><b>Event</b> : An event is a point in code that can trigger multiple callbacks </li>
<li><b>Callback</b> : This is a small bit of code that the user can bind to a specific event, to be executed when it is triggered </li>
<li><b>Node</b> <b>Event</b> : an event that is bound to a specific maya node </li>
<li><b>Global</b> <b>Event</b> : an event that is not bound to any particular node</li>
</ul>
<h1><a class="anchor" id="events_CoreSystem"></a>
Core Event API</h1>
<h2><a class="anchor" id="event_specialisation"></a>
Implementing the System Backend</h2>
<p>The event system itself is defined in such as a way as to allow you to provide a custom backend when initialising the event system. The primary reason for this is to allow a repurposing of the event system into different DCC contexts (e.g. Maya, Houdini, etc). Within the usdmaya plugin, this backend binding is provided in the class MayaEventSystemBinding defined within AL/usdmaya/Global.cpp. The main purpose of this binding is to connect the event system to the underlying logging and scripting capability of the DCC app.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;AL/event/EventHandler.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// indices into the eventTypeStrings array</span></div>
<div class="line">constexpr uint32_t kUserSpecifiedEventType = 0;</div>
<div class="line">constexpr uint32_t kSchemaEventType = 1;</div>
<div class="line">constexpr uint32_t kUSDMayaEventType = 2;</div>
<div class="line">constexpr uint32_t kMayaEventType = 3;</div>
<div class="line"></div>
<div class="line"><span class="comment">// the type strings for the events</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> eventTypeStrings[] =</div>
<div class="line">{</div>
<div class="line">  <span class="stringliteral">&quot;custom&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;schema&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;maya&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;usdmaya&quot;</span></div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// this binds the event system to the logging and scripting API of the DCC context</span></div>
<div class="line"><span class="keyword">class </span>MayaEventSystemBinding</div>
<div class="line">  : <span class="keyword">public</span> AL::maya::EventSystemBinding</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"></div>
<div class="line">  MayaEventSystemBinding()</div>
<div class="line">    : EventSystemBinding(eventTypeStrings, sizeof(eventTypeStrings) / sizeof(const char*)) {}</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">bool</span> executePython(<span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> code)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> MGlobal::executePythonCommand(code, <span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">bool</span> executeMEL(<span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> code)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> MGlobal::executeCommand(code, <span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">void</span> writeLog(AL::maya::EventSystemBinding::Type severity, <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> text)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">switch</span>(severity)</div>
<div class="line">    {</div>
<div class="line">    <span class="keywordflow">case</span> kInfo: MGlobal::displayInfo(text); <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> kWarning: MGlobal::displayWarning(text); <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> kError: MGlobal::displayError(text); <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// provide and instance of the backed DCC binding</span></div>
<div class="line"><span class="keyword">static</span> MayaEventSystemBinding g_eventSystem;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> initEventSystem()</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// when you need to initialise the event system, simple pass a pointer to the backend DCC system.</span></div>
<div class="line">  AL::event::EventScheduler::initScheduler(&amp;g_eventSystem);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="globalEventsC"></a>
Global Events in C++</h2>
<p>The following code sample provides a simple example of how the C++ api works in practice.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;AL/event/EventHandler.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// a global identifier for the event we have created</span></div>
<div class="line">AL::event::EventId g_mySimpleEvent = 0;</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>SimpleEventExample</div>
<div class="line">   : <span class="keyword">public</span> MPxCommand</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span>* creator() { <span class="keywordflow">return</span> <span class="keyword">new</span> SimpleEventExample; }</div>
<div class="line"></div>
<div class="line">  MStatus doIt(<span class="keyword">const</span> MArgList&amp; args)</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// ask the scheduler to trigger any callbacks registered against our event</span></div>
<div class="line">    AL::event::EventScheduler::getScheduler().triggerEvent(g_mySimpleEvent);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">AL::maya::event::CallbackId g_myCallbackId = 0;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> myCallbackFunction(<span class="keywordtype">void</span>* userData)</div>
<div class="line">{</div>
<div class="line">  MGlobal::displayInfo(<span class="stringliteral">&quot;I am a callback!\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">MStatus initializePlugin(MObject obj)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// init the scheduler - this step is only required if you are not using the usdmaya plugin</span></div>
<div class="line">  AL::event::EventScheduler::initScheduler(&amp;g_eventSystem);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// to access the global scheduler</span></div>
<div class="line">  <span class="keyword">auto</span>&amp; scheduler = AL::event::EventScheduler::getScheduler();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// lets register a simple event named &quot;OnSomethingHappened&quot; that is of the type kUserSpecifiedEventType</span></div>
<div class="line">  g_mySimpleEvent = scheduler.registerEvent(<span class="stringliteral">&quot;OnSomethingHappened&quot;</span>, kUserSpecifiedEventType);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// make sure the event registered correctly</span></div>
<div class="line">  <span class="keywordflow">if</span>(g_mySimpleEvent == 0)</div>
<div class="line">  {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;event failed to register (name is in use!)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Simply as an example, we may wish to register a C callback on the event!</span></div>
<div class="line">  g_myCallbackId = scheduler.registerCallback(</div>
<div class="line">    g_mySimpleEvent,                  </div>
<div class="line">    <span class="stringliteral">&quot;myToolName_myCallbackFunction&quot;</span>,  </div>
<div class="line">    myCallbackFunction,               </div>
<div class="line">    10000,                            </div>
<div class="line">    <span class="keyword">nullptr</span>);                         </div>
<div class="line"></div>
<div class="line">  <span class="comment">// make sure the callback registered correctly</span></div>
<div class="line">  <span class="keywordflow">if</span>(g_myCallbackId == 0)</div>
<div class="line">  {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;callback failed to register (tag is in use, or event id is invalid)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  MFnPlugin fn(obj);</div>
<div class="line">  fn.registerCommand(<span class="stringliteral">&quot;simpleEventExample&quot;</span>, SimpleEventExample::creator);</div>
<div class="line">  <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">MStatus uninitializePlugin(MObject obj)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// unregister the callback</span></div>
<div class="line">  AL::event::EventScheduler::getScheduler().unregisterCallback(g_myCallbackId);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// unregister the event</span></div>
<div class="line">  AL::event::EventScheduler::getScheduler().unregisterEvent(g_mySimpleEvent);</div>
<div class="line"></div>
<div class="line">  MFnPlugin fn(obj);</div>
<div class="line">  fn.unregisterCommand(<span class="stringliteral">&quot;simpleEventExample&quot;</span>);</div>
<div class="line"></div>
<div class="line">  maya::EventScheduler::freeScheduler();</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">}</div>
</div><!-- fragment --><p>It should be noted that once this plugin have been loaded, there are a number of MEL commands exposed that allow you to interact with that event in MEL/python script. Firstly we can get a list of the global events registered:</p>
<div class="fragment"><div class="line">print `AL_usdmaya_ListEvents`;</div>
<div class="line"></div>
<div class="line"><span class="comment">// will print:</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  OnSomethingHappened</span></div>
</div><!-- fragment --><p>We can also trigger the event from MEL/python if we wish:</p>
<div class="fragment"><div class="line">AL_usdmaya_TriggerEvent <span class="stringliteral">&quot;OnSomethingHappened&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// will execute &#39;myCallbackFunction&#39; and print the following to the script editor output:</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  I am a callback!</span></div>
</div><!-- fragment --><p>Via the MEL command AL_usdmaya_Callback it is possible to assign a callback from a MEL or python script.</p>
<div class="fragment"><div class="line"><span class="comment">// simple callback</span></div>
<div class="line"><span class="keywordtype">string</span> $melCodeToExecute = <span class="stringliteral">&quot;print \&quot;mel callback!\n\&quot;&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// -me/-melEvent flag arguments: (note: -pe/-pythonEvent will treat the callback code as python)</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// * The event name</span></div>
<div class="line"><span class="comment">// * A unique tag to identify the callback</span></div>
<div class="line"><span class="comment">// * The integer weight for the callback</span></div>
<div class="line"><span class="comment">// * The MEL script to execute</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">global <span class="keywordtype">int</span> $callbackId[] = `AL_usdmaya_Callback -me <span class="stringliteral">&quot;OnSomethingHappened&quot;</span> <span class="stringliteral">&quot;MyMelScript_operation&quot;</span> 10001 $melCodeToExecute`;</div>
</div><!-- fragment --><p>You will notice that the callback id's are returned as an array. This is simply because the C++ Callback ID's are 64bit, however sadly MEL does not support 64bit integer values, so the callbacks are returned as a pair of 32bit integers. These pair of callback values can be used to query some information about the callback using the command AL_usdmaya_CallbackQuery</p>
<div class="fragment"><div class="line"><span class="comment">// print the tag for the callback</span></div>
<div class="line">print (<span class="stringliteral">&quot;tag: &quot;</span> + `AL_usdmaya_CallbackQuery -tag $callbackId[0] $callbackId[1]` + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// print the eventId for the callback</span></div>
<div class="line">print (<span class="stringliteral">&quot;eventId: &quot;</span> + `AL_usdmaya_CallbackQuery -e $callbackId[0] $callbackId[1]` + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// print the type of the callback (returns &quot;Python&quot;, &quot;MEL&quot;, or &quot;C&quot;)</span></div>
<div class="line">print (<span class="stringliteral">&quot;type: &quot;</span> + `AL_usdmaya_CallbackQuery -ty $callbackId[0] $callbackId[1]` + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// print the callback weight</span></div>
<div class="line">print (<span class="stringliteral">&quot;weight: &quot;</span> + `AL_usdmaya_CallbackQuery -w $callbackId[0] $callbackId[1]` + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// print the callback code</span></div>
<div class="line">print (<span class="stringliteral">&quot;code: &quot;</span> + `AL_usdmaya_CallbackQuery -c $callbackId[0] $callbackId[1]` + <span class="stringliteral">&quot;\n&quot;</span>);</div>
</div><!-- fragment --><p>If you wish to see which callbacks are registered against a specific event, you can use the AL_usdmaya_ListCallbacks command, e.g.</p>
<div class="fragment"><div class="line">proc printCallbackInfo(<span class="keywordtype">string</span> $eventName)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> $callbackIds[] = `AL_usdmaya_ListCallbacks $eventName`;</div>
<div class="line">  print (<span class="stringliteral">&quot;EventBreakdown: &quot;</span> + $eventName + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> $i = 0; $i &lt; size($callbackIds); $i += 2)</div>
<div class="line">  {</div>
<div class="line">    print (<span class="stringliteral">&quot;callback &quot;</span> + ($i / 2 + 1) + <span class="stringliteral">&quot; : [&quot;</span> + $callbackIds[$i] + <span class="stringliteral">&quot;, &quot;</span> + $callbackIds[$i + 1] + <span class="stringliteral">&quot;]\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// print the tag for the callback</span></div>
<div class="line">    print (<span class="stringliteral">&quot;  tag: &quot;</span> + `AL_usdmaya_CallbackQuery -tag $callbackIds[$i] $callbackIds[$i + 1]` + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// print the eventId for the callback</span></div>
<div class="line">    print (<span class="stringliteral">&quot;  eventId: &quot;</span> + `AL_usdmaya_CallbackQuery -e $callbackIds[$i] $callbackIds[$i + 1]` + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// print the type of the callback (returns &quot;Python&quot;, &quot;MEL&quot;, or &quot;C&quot;)</span></div>
<div class="line">    print (<span class="stringliteral">&quot;  type: &quot;</span> + `AL_usdmaya_CallbackQuery -ty $callbackIds[$i] $callbackIds[$i + 1]` + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// print the callback weight</span></div>
<div class="line">    print (<span class="stringliteral">&quot;  weight: &quot;</span> + `AL_usdmaya_CallbackQuery -w $callbackIds[$i] $callbackIds[$i + 1]` + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// print the callback code</span></div>
<div class="line">    print (<span class="stringliteral">&quot;  code: \n----------------------------------------------------------------\n&quot;</span> +</div>
<div class="line">              `AL_usdmaya_CallbackQuery -c $callbackIds[$i] $callbackIds[$i + 1]` +</div>
<div class="line">              <span class="stringliteral">&quot;\n----------------------------------------------------------------\n&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// find out info about the OnSomethingHappened event</span></div>
<div class="line">printCallbackInfo(<span class="stringliteral">&quot;OnSomethingHappened&quot;</span>);</div>
</div><!-- fragment --><p>If you wish to delete a callback, then you can do it in one of two ways:</p>
<div class="fragment"><div class="line"><span class="comment">// either use the -d/-delete flag to delete the callback,</span></div>
<div class="line">AL_usdmaya_Callback -d $callbackId[0] $callbackId[1];</div>
<div class="line"></div>
<div class="line"><span class="comment">// or pass an array of callback id pairs to the AL_usdmaya_DeleteCallbacks command</span></div>
<div class="line">AL_usdmaya_DeleteCallbacks $callbackId[0];</div>
</div><!-- fragment --><p>It is also possible to define entirely new events in your own MEL or python scripts, e.g.</p>
<div class="fragment"><div class="line"><span class="comment">// create a new event</span></div>
<div class="line">AL_usdmaya_Event <span class="stringliteral">&quot;AnEventDefinedInMEL&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// you can now trigger the event (and attach callbacks)</span></div>
<div class="line">AL_usdmaya_TriggerEvent <span class="stringliteral">&quot;AnEventDefinedInMEL&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// and to delete the event</span></div>
<div class="line">AL_usdmaya_Event -d <span class="stringliteral">&quot;AnEventDefinedInMEL&quot;</span>;</div>
</div><!-- fragment --><h2><a class="anchor" id="nodeEventsC"></a>
Node Events in C++</h2>
<p>To make use of the maya node events, your node should derive from the AL::usdmaya::nodes::MayaNodeEvents class. A simple example of setting a node up with the events system would look like so:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;AL/event/EventHandler.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// To make use of the node events, ensure you derive a node from the MayaNodeEvents class.</span></div>
<div class="line"><span class="keyword">class </span>MyMayaNode</div>
<div class="line">  : <span class="keyword">public</span> MPxNode,</div>
<div class="line">    <span class="keyword">public</span> AL::maya::NodeEvents</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"></div>
<div class="line">  MyMayaNode()</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// simply call registerEvent() for each event you wish to register</span></div>
<div class="line">    registerEvent(<span class="stringliteral">&quot;PreThingHappened&quot;</span>, kUserSpecifiedEventType);</div>
<div class="line">    registerEvent(<span class="stringliteral">&quot;PostThingHappened&quot;</span>, kUserSpecifiedEventType);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  ~MyMayaNode()</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// you don&#39;t need to unregister events (events are automatically unregistered in the MayaNodeEvents dtor).</span></div>
<div class="line">    <span class="comment">// This is only here for example purposes</span></div>
<div class="line">    unregisterEvent(<span class="stringliteral">&quot;PreThingHappened&quot;</span>);</div>
<div class="line">    unregisterEvent(<span class="stringliteral">&quot;PostThingHappened&quot;</span>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">void</span> thingHappened()</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// trigger the first event</span></div>
<div class="line">    triggerEvent(<span class="stringliteral">&quot;PreThingHappened&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// do some magical operation</span></div>
<div class="line">    doTheThing();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// trigger second event</span></div>
<div class="line">    triggerEvent(<span class="stringliteral">&quot;PostThingHappened&quot;</span>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Typical Maya node implementation assumed to be here</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">};</div>
</div><!-- fragment --><p>That's basically the only setup you need to perform in order to make a custom plugin node compatible with the events system. We can now use AL_usdmaya_ListEvents to get a list of the events that the node supports</p>
<div class="fragment"><div class="line"><span class="comment">// create a node that supports events</span></div>
<div class="line">$node = `createNode <span class="stringliteral">&quot;MyMayaNode&quot;</span>`;</div>
<div class="line"></div>
<div class="line"><span class="comment">// list the events available on the node</span></div>
<div class="line">print `AL_usdmaya_ListEvents $node`;</div>
<div class="line"></div>
<div class="line"><span class="comment">// will print:</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  PreThingHappened</span></div>
<div class="line"><span class="comment">//  PostThingHappened</span></div>
</div><!-- fragment --><p>Via the MEL command AL_usdmaya_Callback it is possible to assign a callback from a MEL or python script to that node.</p>
<div class="fragment"><div class="line"><span class="comment">// simple callback</span></div>
<div class="line"><span class="keywordtype">string</span> $melCodeToExecute = <span class="stringliteral">&quot;print \&quot;mel callback!\n\&quot;&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// -mne/-melNodeEvent flag arguments: (note: -pne/-pythonNodeEvent will treat the callback code as python)</span></div>
<div class="line"><span class="comment">// * The node name</span></div>
<div class="line"><span class="comment">// * The event name</span></div>
<div class="line"><span class="comment">// * A unique tag to identify the callback</span></div>
<div class="line"><span class="comment">// * The integer weight for the callback</span></div>
<div class="line"><span class="comment">// * The MEL script to execute</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">global <span class="keywordtype">int</span> $callbackId[] = `AL_usdmaya_Callback -mne $node <span class="stringliteral">&quot;PreThingHappened&quot;</span> <span class="stringliteral">&quot;MyMelScript_operation&quot;</span> 10001 $melCodeToExecute`;</div>
</div><!-- fragment --><p>We can also trigger the event from MEL/python if we wish:</p>
<div class="fragment"><div class="line">AL_usdmaya_TriggerEvent <span class="stringliteral">&quot;PreThingHappened&quot;</span> $node;</div>
<div class="line"></div>
<div class="line"><span class="comment">// will execute &#39;myCallbackFunction&#39; and print the following to the script editor output:</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  mel callback!</span></div>
</div><!-- fragment --><p>As with the Global Events, these pair of callback values can be used to query some information about the callback using the command AL_usdmaya_CallbackQuery</p>
<div class="fragment"><div class="line"><span class="comment">// print the tag for the callback</span></div>
<div class="line">print (<span class="stringliteral">&quot;tag: &quot;</span> + `AL_usdmaya_CallbackQuery -tag $callbackId[0] $callbackId[1]` + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// print the eventId for the callback</span></div>
<div class="line">print (<span class="stringliteral">&quot;eventId: &quot;</span> + `AL_usdmaya_CallbackQuery -e $callbackId[0] $callbackId[1]` + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// print the type of the callback (returns &quot;Python&quot;, &quot;MEL&quot;, or &quot;C&quot;)</span></div>
<div class="line">print (<span class="stringliteral">&quot;type: &quot;</span> + `AL_usdmaya_CallbackQuery -ty $callbackId[0] $callbackId[1]` + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// print the callback weight</span></div>
<div class="line">print (<span class="stringliteral">&quot;weight: &quot;</span> + `AL_usdmaya_CallbackQuery -w $callbackId[0] $callbackId[1]` + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// print the callback code</span></div>
<div class="line">print (<span class="stringliteral">&quot;code: &quot;</span> + `AL_usdmaya_CallbackQuery -c $callbackId[0] $callbackId[1]` + <span class="stringliteral">&quot;\n&quot;</span>);</div>
</div><!-- fragment --><p>If you wish to see which callbacks are registered against a specific event, you can use the AL_usdmaya_ListCallbacks command, e.g.</p>
<div class="fragment"><div class="line">proc printNodeCallbackInfo(<span class="keywordtype">string</span> $eventName, <span class="keywordtype">string</span> $node)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> $callbackIds[] = `AL_usdmaya_ListCallbacks $eventName $node`;</div>
<div class="line">  print (<span class="stringliteral">&quot;EventBreakdown for node: &quot;</span> + $node + <span class="stringliteral">&quot; and event: &quot;</span> + $eventName + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> $i = 0; $i &lt; size($callbackIds); $i += 2)</div>
<div class="line">  {</div>
<div class="line">    print (<span class="stringliteral">&quot;callback &quot;</span> + ($i / 2 + 1) + <span class="stringliteral">&quot; : [&quot;</span> + $callbackIds[$i] + <span class="stringliteral">&quot;, &quot;</span> + $callbackIds[$i + 1] + <span class="stringliteral">&quot;]\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// print the tag for the callback</span></div>
<div class="line">    print (<span class="stringliteral">&quot;  tag: &quot;</span> + `AL_usdmaya_CallbackQuery -tag $callbackIds[$i] $callbackIds[$i + 1]` + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// print the eventId for the callback</span></div>
<div class="line">    print (<span class="stringliteral">&quot;  eventId: &quot;</span> + `AL_usdmaya_CallbackQuery -e $callbackIds[$i] $callbackIds[$i + 1]` + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// print the type of the callback (returns &quot;Python&quot;, &quot;MEL&quot;, or &quot;C&quot;)</span></div>
<div class="line">    print (<span class="stringliteral">&quot;  type: &quot;</span> + `AL_usdmaya_CallbackQuery -ty $callbackIds[$i] $callbackIds[$i + 1]` + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// print the callback weight</span></div>
<div class="line">    print (<span class="stringliteral">&quot;  weight: &quot;</span> + `AL_usdmaya_CallbackQuery -w $callbackIds[$i] $callbackIds[$i + 1]` + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// print the callback code</span></div>
<div class="line">    print (<span class="stringliteral">&quot;  code: \n----------------------------------------------------------------\n&quot;</span> +</div>
<div class="line">              `AL_usdmaya_CallbackQuery -c $callbackIds[$i] $callbackIds[$i + 1]` +</div>
<div class="line">              <span class="stringliteral">&quot;\n----------------------------------------------------------------\n&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// find out info about the OnSomethingHappened event</span></div>
<div class="line">printNodeCallbackInfo(<span class="stringliteral">&quot;PreThingHappened&quot;</span>, $node);</div>
</div><!-- fragment --><p>If you wish to delete a callback, then you can do it in one of two ways:</p>
<div class="fragment"><div class="line"><span class="comment">// either use the -d/-delete flag to delete the callback,</span></div>
<div class="line">AL_usdmaya_Callback -d $callbackId[0] $callbackId[1];</div>
<div class="line"></div>
<div class="line"><span class="comment">// or pass an array of callback id pairs to the AL_usdmaya_DeleteCallbacks command</span></div>
<div class="line">AL_usdmaya_DeleteCallbacks $callbackId[0];</div>
</div><!-- fragment --><p>It is also possible to define entirely new events on the node in your own MEL or python scripts, e.g.</p>
<div class="fragment"><div class="line"><span class="comment">// create a new event</span></div>
<div class="line">AL_usdmaya_Event <span class="stringliteral">&quot;AnEventDefinedInMEL&quot;</span> $node;</div>
<div class="line"></div>
<div class="line"><span class="comment">// you can now trigger the event (and attach callbacks)</span></div>
<div class="line">AL_usdmaya_TriggerEvent <span class="stringliteral">&quot;AnEventDefinedInMEL&quot;</span> $node;</div>
<div class="line"></div>
<div class="line"><span class="comment">// and to delete the event</span></div>
<div class="line">AL_usdmaya_Event -d <span class="stringliteral">&quot;AnEventDefinedInMEL&quot;</span> $node;</div>
</div><!-- fragment --><h2><a class="anchor" id="parentEventsC"></a>
Parent / Child events in C++</h2>
<p>As an optional part of the events system, it is possible to provide additional information to an event that describes a parent/child relationship between callbacks and events. Child events themselves are not triggered automatically (that task is something that needs to be done manually), and child events can only be parented to a callback.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;AL/event/EventHandler.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// a global identifier for the event we have created</span></div>
<div class="line">AL::event::EventId g_mySimpleEvent1 = 0;</div>
<div class="line">AL::event::EventId g_mySimpleEvent2 = 0;</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>ParentEventExample</div>
<div class="line">   : <span class="keyword">public</span> MPxCommand</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span>* creator() { <span class="keywordflow">return</span> <span class="keyword">new</span> ParentEventExample; }</div>
<div class="line"></div>
<div class="line">  MStatus doIt(<span class="keyword">const</span> MArgList&amp; args)</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// ask the scheduler to trigger any callbacks registered against our event</span></div>
<div class="line">    AL::event::EventScheduler::getScheduler().triggerEvent(g_mySimpleEvent1);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">AL::maya::event::CallbackId g_myCallbackId1 = 0;</div>
<div class="line">AL::maya::event::CallbackId g_myCallbackId2 = 0;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> myCallbackFunction1(<span class="keywordtype">void</span>* userData)</div>
<div class="line">{</div>
<div class="line">  MGlobal::displayInfo(<span class="stringliteral">&quot;I am a callback that will trigger an event!\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">  AL::event::EventScheduler::getScheduler().triggerEvent(g_mySimpleEvent2);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> myCallbackFunction2(<span class="keywordtype">void</span>* userData)</div>
<div class="line">{</div>
<div class="line">  MGlobal::displayInfo(<span class="stringliteral">&quot;I am the child callback!\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">MStatus initializePlugin(MObject obj)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// init the scheduler - this step is only required if you are not using the usdmaya plugin</span></div>
<div class="line">  AL::event::EventScheduler::initScheduler(&amp;g_eventSystem);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// to access the global scheduler</span></div>
<div class="line">  <span class="keyword">auto</span>&amp; scheduler = AL::event::EventScheduler::getScheduler();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// lets register a simple event</span></div>
<div class="line">  g_mySimpleEvent1 = scheduler.registerEvent(<span class="stringliteral">&quot;OnParentThingHappened&quot;</span>, kUserSpecifiedEventType);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// make sure the event registered correctly</span></div>
<div class="line">  <span class="keywordflow">if</span>(g_mySimpleEvent1 == 0)</div>
<div class="line">  {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;event failed to register (name is in use!)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Simply as an example, we may wish to register a C callback on the event!</span></div>
<div class="line">  g_myCallbackId1 = scheduler.registerCallback(</div>
<div class="line">    g_mySimpleEvent1,                 </div>
<div class="line">    <span class="stringliteral">&quot;myToolName_myCallbackFunction1&quot;</span>, </div>
<div class="line">    myCallbackFunction1,              </div>
<div class="line">    10000,                            </div>
<div class="line">    <span class="keyword">nullptr</span>);                         </div>
<div class="line"></div>
<div class="line">  <span class="comment">// make sure the callback registered correctly</span></div>
<div class="line">  <span class="keywordflow">if</span>(g_myCallbackId1 == 0)</div>
<div class="line">  {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;callback failed to register (tag is in use, or event id is invalid)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// lets register a simple event</span></div>
<div class="line">  g_mySimpleEvent2 = scheduler.registerEvent(<span class="stringliteral">&quot;OnChildThingHappened&quot;</span>, kUserSpecifiedEventType, g_myCallbackId1);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// make sure the event registered correctly</span></div>
<div class="line">  <span class="keywordflow">if</span>(g_mySimpleEvent2 == 0)</div>
<div class="line">  {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;event failed to register (name is in use!)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Simply as an example, we may wish to register a C callback on the event!</span></div>
<div class="line">  g_myCallbackId2 = scheduler.registerCallback(</div>
<div class="line">    g_mySimpleEvent2,                 </div>
<div class="line">    <span class="stringliteral">&quot;myToolName_myCallbackFunction2&quot;</span>, </div>
<div class="line">    myCallbackFunction2,              </div>
<div class="line">    10000,                            </div>
<div class="line">    <span class="keyword">nullptr</span>);                         </div>
<div class="line"></div>
<div class="line">  <span class="comment">// make sure the callback registered correctly</span></div>
<div class="line">  <span class="keywordflow">if</span>(g_myCallbackId2 == 0)</div>
<div class="line">  {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;callback failed to register (tag is in use, or event id is invalid)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  MFnPlugin fn(obj);</div>
<div class="line">  fn.registerCommand(<span class="stringliteral">&quot;parentEventExample&quot;</span>, ParentEventExample::creator);</div>
<div class="line">  <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">MStatus uninitializePlugin(MObject obj)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// unregister the callback</span></div>
<div class="line">  AL::event::EventScheduler::getScheduler().unregisterCallback(g_myCallbackId2);</div>
<div class="line">  AL::event::EventScheduler::getScheduler().unregisterCallback(g_myCallbackId1);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// unregister the event</span></div>
<div class="line">  AL::event::EventScheduler::getScheduler().unregisterEvent(g_mySimpleEvent2);</div>
<div class="line">  AL::event::EventScheduler::getScheduler().unregisterEvent(g_mySimpleEvent1);</div>
<div class="line"></div>
<div class="line">  MFnPlugin fn(obj);</div>
<div class="line">  fn.unregisterCommand(<span class="stringliteral">&quot;parentEventExample&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="parentEventsM"></a>
Parent / Child events in MEL</h2>
<p>To set up a parent/child relationship between callbacks in MEL or python, use the -p flag when creating the child event. A simple example follows:</p>
<div class="fragment"><div class="line"><span class="comment">// the names of our events</span></div>
<div class="line"><span class="keywordtype">string</span> $mainEventName = <span class="stringliteral">&quot;ParentEvent&quot;</span>;</div>
<div class="line"><span class="keywordtype">string</span> $childEventName = <span class="stringliteral">&quot;ChildEvent&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// generate a high level event</span></div>
<div class="line">AL_usdmaya_Event $mainEventName;</div>
<div class="line"></div>
<div class="line"><span class="comment">// generate a callback command that triggers the child event</span></div>
<div class="line"><span class="keywordtype">string</span> $parentCommand = <span class="stringliteral">&quot;AL_usdmaya_TriggerEvent &quot;</span> + $childEventName + <span class="stringliteral">&quot;;&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// assign a callback to it, and make sure it can be triggered</span></div>
<div class="line"><span class="keywordtype">int</span> $parentCB[] = `AL_usdmaya_Callback -me $mainEventName <span class="stringliteral">&quot;parentEvent&quot;</span> 10000 $parentCommand`;</div>
<div class="line"></div>
<div class="line"><span class="comment">// generate a child event, and pass the identifier of the parent callback that will trigger the</span></div>
<div class="line"><span class="comment">// child event.</span></div>
<div class="line">AL_usdmaya_Event -p $parentCB[0] $parentCB[1] $childEventName;</div>
<div class="line"></div>
<div class="line"><span class="comment">// a simple child command that creates a sphere</span></div>
<div class="line"><span class="keywordtype">string</span> $childCommand = <span class="stringliteral">&quot;sphere;&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// assign a callback to it, and make sure it can be triggered</span></div>
<div class="line"><span class="keywordtype">int</span> $childCB[] = `AL_usdmaya_Callback -me $childEventName <span class="stringliteral">&quot;childEvent&quot;</span> 10000 $childCommand`;</div>
<div class="line"></div>
<div class="line"><span class="comment">// trigger the main event, which will in turn trigger the child event</span></div>
<div class="line">AL_usdmaya_TriggerEvent $mainEventName;</div>
</div><!-- fragment --><p>If you wish to determine the parent callback of a given event, you can query that information via the AL_usdmaya_EventQuery command with the -p / -parent flag:</p>
<div class="fragment"><div class="line"><span class="comment">// query the parent callback to the child event</span></div>
<div class="line"><span class="keywordtype">int</span> $parentCallback[] = `AL_usdmaya_EventQuery -p $childEventName`;</div>
<div class="line"></div>
<div class="line"><span class="comment">// quickly check to see whether the event has a callback or not</span></div>
<div class="line"><span class="keywordflow">if</span>(size($parentCallback))</div>
<div class="line">{</div>
<div class="line">  print (<span class="stringliteral">&quot;parent callback of &quot;</span> + $childEventName + <span class="stringliteral">&quot; has ID [&quot;</span> + $parentCallback[0] + <span class="stringliteral">&quot;, &quot;</span> + $parentCallback[1] + <span class="stringliteral">&quot;]\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">{</div>
<div class="line">  print ($childEventName + <span class="stringliteral">&quot; does not have a parent callback\&quot;);</span></div>
<div class="line"><span class="stringliteral">}</span></div>
</div><!-- fragment --><p>similarly, given a callback you can determine the child event ID's via the AL_usdmaya_CallbackQuery command and the -ce / -childEvents flag:</p>
<div class="fragment"><div class="line"><span class="comment">// query the parent callback to the child event</span></div>
<div class="line"><span class="keywordtype">int</span> $childEventIds[] = `AL_usdmaya_CallbackQuery -ce $mainEventName $parentCallback[0] $parentCallback[1]`;</div>
<div class="line"></div>
<div class="line"><span class="comment">// quickly check to see whether the event has a callback or not</span></div>
<div class="line"><span class="keywordflow">for</span>($event in $childEventIds)</div>
<div class="line">{</div>
<div class="line">  print (<span class="stringliteral">&quot;eventID &quot;</span> + $event + <span class="stringliteral">&quot; is a child of callback &quot;</span> +  $parentCallback[0] + <span class="stringliteral">&quot; &quot;</span> + $parentCallback[1] + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>If you wish to convert the event ID back into the text name (and possibly get the associated node) you the AL_usdmaya_EventLookup command</p>
<div class="fragment"><div class="line"><span class="comment">// query the parent callback to the child event</span></div>
<div class="line"><span class="keywordtype">int</span> $childEventIds[] = `AL_usdmaya_CallbackQuery -ce $mainEventName $parentCallback[0] $parentCallback[1]`;</div>
<div class="line"></div>
<div class="line"><span class="comment">// quickly check to see whether the event has a callback or not</span></div>
<div class="line"><span class="keywordflow">for</span>($event in $childEventIds)</div>
<div class="line">{</div>
<div class="line">  print (<span class="stringliteral">&quot;eventID &quot;</span> + $event + <span class="stringliteral">&quot; is a child of callback &quot;</span> +  $parentCallback[0] + <span class="stringliteral">&quot; &quot;</span> + $parentCallback[1] + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">  print (<span class="stringliteral">&quot;  - eventName  &quot;</span> + `AL_usdmaya_EventLookup -name $event` + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">  print (<span class="stringliteral">&quot;  - owningNode &quot;</span> + `AL_usdmaya_EventLookup -node $event` + <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Nov 2 2018 11:40:20 for AL_USDMaya by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.7 </li>
  </ul>
</div>
</body>
</html>
